<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Knowledge Assistant</title>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-30px); }
        to { opacity: 1; transform: translateX(0); }
      }
      @keyframes slideInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }
      @keyframes fogMove {
        0% { transform: translate(0, 0) scale(1); }
        33% { transform: translate(40px, -40px) scale(1.15); }
        66% { transform: translate(-30px, 30px) scale(0.9); }
        100% { transform: translate(0, 0) scale(1); }
      }
      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }
      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html, body {
        height: 100%;
        overflow: hidden;
      }
      
      :root {
        --theme-color: rgba(84, 8, 66, 0.356);
        --theme-color-hover: rgba(108, 20, 87, 0.747);
        --theme-color-dark: rgba(84, 8, 66, 0.8);
        --theme-color-solid: #6c1457;
        --theme-color-bright: #8b1a6f;
        --white: #ffffff;
        --text-dark: #1a1a1a;
        --text-secondary: #333333;
        --border-color: rgba(84, 8, 66, 0.25);
        --shadow: rgba(84, 8, 66, 0.2);
        --shadow-strong: rgba(84, 8, 66, 0.4);
        --purple-light: rgba(139, 92, 246, 0.1);
        --purple-medium: rgba(139, 92, 246, 0.2);
      }
      
      [data-theme="dark"] {
        --white: #1a1a1a;
        --text-dark: #f3f4f6;
        --text-secondary: #9ca3af;
        --border-color: rgba(84, 8, 66, 0.3);
        --shadow: rgba(84, 8, 66, 0.25);
        --shadow-strong: rgba(84, 8, 66, 0.4);
      }
      
      body {
        font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        background: #ffffff;
        min-height: 100vh;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        color: var(--text-dark);
        transition: background 0.3s ease, color 0.3s ease;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url('https://i.pinimg.com/736x/84/5b/0c/845b0cccab795cd765334cfc3e096341.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        z-index: -2;
      }
      
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(84, 8, 66, 0.356);
        backdrop-filter: blur(50px);
        -webkit-backdrop-filter: blur(50px);
        z-index: -1;
        pointer-events: none;
      }
      
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--theme-color-solid);
        border: 2px solid var(--white);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        z-index: 1001;
        box-shadow: 0 4px 16px var(--shadow-strong);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }
      
      .theme-toggle:hover {
        transform: scale(1.1);
        background: var(--theme-color-bright);
        box-shadow: 0 6px 20px var(--shadow-strong);
      }
      
      .chat-wrapper {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        position: relative;
        z-index: 1;
        align-items: center;
        justify-content: center;
      }

      .chat-container {
        width: 100%;
        max-width: 900px;
        height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      
      .chat-header {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        padding: 18px 25px;
        border-bottom: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 15px var(--shadow);
        flex-shrink: 0;
        border-radius: 0;
      }

      [data-theme="dark"] .chat-header {
        background: rgba(26, 26, 26, 0.98);
      }
      
      .header-left {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      
      .header-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, var(--theme-color-solid) 0%, var(--theme-color-bright) 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: white;
        box-shadow: 0 4px 12px var(--shadow);
        flex-shrink: 0;
      }

      .header-icon svg {
        width: 28px;
        height: 28px;
      }
      
      .header-text h1 {
        font-size: 22px;
        font-weight: 800;
        background: linear-gradient(135deg, var(--theme-color-solid) 0%, var(--theme-color-bright) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
        letter-spacing: -0.5px;
      }
      
      .header-text p {
        font-size: 12px;
        color: var(--text-secondary);
        margin: 3px 0 0 0;
        font-weight: 500;
      }
      
      .header-actions {
        display: flex;
        gap: 8px;
        margin-right: 60px;
      }
      
      .header-btn {
        padding: 8px 14px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        background: var(--white);
        color: var(--text-dark);
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 6px var(--shadow);
      }

      [data-theme="dark"] .header-btn {
        background: #2a2a2a;
        border-color: var(--border-color);
      }
      
      .header-btn:hover {
        border-color: var(--theme-color-solid);
        background: linear-gradient(135deg, var(--theme-color-solid) 0%, var(--theme-color-bright) 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-strong);
      }
      
      .messages-container {
        flex: 1;
        overflow-y: auto;
        padding: 25px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
        scroll-behavior: smooth;
        overflow-x: hidden;
      }

      [data-theme="dark"] .messages-container {
        background: rgba(26, 26, 26, 0.5);
      }
      
      .messages-container::-webkit-scrollbar {
        width: 8px;
      }
      
      .messages-container::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .messages-container::-webkit-scrollbar-thumb {
        background: var(--theme-color);
        border-radius: 10px;
      }
      
      .messages-container::-webkit-scrollbar-thumb:hover {
        background: var(--theme-color-hover);
      }
      
      .message {
        margin-bottom: 24px;
        display: flex;
        animation: fadeIn 0.4s ease-out;
      }
      
      .message.user {
        justify-content: flex-end;
        animation: slideInRight 0.4s ease-out;
      }
      
      .message.bot {
        justify-content: flex-start;
        animation: slideInLeft 0.4s ease-out;
      }
      
      .message-bubble {
        max-width: 75%;
        padding: 14px 18px;
        border-radius: 16px;
        line-height: 1.6;
        word-wrap: break-word;
        position: relative;
        box-shadow: 0 2px 10px var(--shadow);
      }
      
      .message.user .message-bubble {
        background: linear-gradient(135deg, var(--theme-color-solid) 0%, var(--theme-color-bright) 100%);
        color: white;
        border-bottom-right-radius: 4px;
        box-shadow: 0 4px 16px var(--shadow-strong);
      }
      
      .message.bot .message-bubble {
        background: var(--white);
        color: var(--text-dark);
        border: 2px solid var(--border-color);
        border-bottom-left-radius: 4px;
        box-shadow: 0 2px 10px var(--shadow);
      }

      [data-theme="dark"] .message.bot .message-bubble {
        background: #2a2a2a;
        border-color: var(--border-color);
      }
      
      .message.bot .message-bubble.thinking {
        background: linear-gradient(90deg, var(--white) 0%, var(--purple-light) 50%, var(--white) 100%);
        background-size: 200% 100%;
        animation: shimmer 2s infinite, pulse 1.5s ease-in-out infinite;
      }
      
      .message.bot .message-bubble.typing::after {
        content: '‚ñä';
        animation: blink 1s infinite;
        margin-left: 4px;
        color: var(--theme-color);
      }
      
      .message-actions {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      
      .message:hover .message-actions {
        opacity: 1;
      }
      
      .action-btn {
        padding: 6px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--white);
        color: var(--text-dark);
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s ease;
      }

      [data-theme="dark"] .action-btn {
        background: #2a2a2a;
      }
      
      .action-btn:hover {
        background: var(--theme-color);
        color: white;
        border-color: var(--theme-color);
      }
      
      .message-source {
        font-size: 11px;
        color: var(--text-secondary);
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid var(--border-color);
        font-style: italic;
        opacity: 0.8;
      }
      
      .input-container {
        padding: 15px 25px;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        border-top: 2px solid var(--border-color);
        display: flex;
        gap: 12px;
        flex-shrink: 0;
      }

      [data-theme="dark"] .input-container {
        background: rgba(26, 26, 26, 0.98);
      }
      
      .input-wrapper {
        flex: 1;
        position: relative;
      }
      
      .input-wrapper input {
        width: 100%;
        padding: 12px 18px;
        padding-right: 45px;
        border: 2px solid var(--border-color);
        border-radius: 14px;
        font-size: 14px;
        background: var(--white);
        color: var(--text-dark);
        transition: all 0.3s ease;
        font-family: inherit;
      }

      [data-theme="dark"] .input-wrapper input {
        background: #2a2a2a;
      }
      
      .input-wrapper input:focus {
        outline: none;
        border-color: var(--theme-color-solid);
        box-shadow: 0 0 0 3px var(--purple-light);
        transform: translateY(-1px);
      }
      
      .input-wrapper input::placeholder {
        color: var(--text-secondary);
        opacity: 0.6;
      }
      
      .send-button {
        padding: 12px 24px;
        border-radius: 14px;
        border: 2px solid transparent;
        background: linear-gradient(135deg, var(--theme-color-solid) 0%, var(--theme-color-bright) 100%);
        color: white;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px var(--shadow);
        min-width: 90px;
      }
      
      .send-button:hover {
        background: linear-gradient(135deg, var(--theme-color-bright) 0%, var(--theme-color-solid) 100%);
        border-color: var(--theme-color-solid);
        transform: translateY(-2px);
        box-shadow: 0 6px 18px var(--shadow-strong);
      }
      
      .send-button:active {
        transform: translateY(0);
      }
      
      .send-button:disabled {
        background: #d1d5db;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        border-color: transparent;
      }
      
      @media (max-width: 768px) {
        .chat-header {
          padding: 15px 20px;
        }
        
        .header-text h1 {
          font-size: 20px;
        }
        
        .messages-container {
          padding: 20px;
        }
        
        .message-bubble {
          max-width: 85%;
        }
        
        .theme-toggle {
          width: 45px;
          height: 45px;
          font-size: 20px;
          top: 15px;
          right: 15px;
        }

        .header-actions {
          display: none;
        }

        .chat-container {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body data-theme="light">
    <button class="theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
      <span id="themeIcon">üåô</span>
    </button>
    
    <div class="chat-wrapper">
      <div class="chat-container">
        <div class="chat-header">
          <div class="header-left">
            <div class="header-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="white">
                <rect x="10" y="10" width="80" height="80" rx="20" fill="currentColor"/>
                <circle cx="50" cy="50" r="25" fill="none" stroke="white" stroke-width="6"/>
                <circle cx="50" cy="50" r="12" fill="white"/>
              </svg>
            </div>
            <div class="header-text">
              <h1>OCTAVIUS</h1>
              <p>Powered by Xebia ‚Ä¢ Ask questions about your knowledge base</p>
            </div>
          </div>
          <div class="header-actions">
            <button class="header-btn" id="clearBtn" title="Clear Chat">
              üóëÔ∏è Clear
            </button>
          </div>
        </div>
        
        <div class="messages-container" id="msgs">
          <div class="message bot">
            <div class="message-bubble">
              Hello! I'm your AI Knowledge Assistant. I can answer questions based on your knowledge base dataset. How can I help you today?
            </div>
          </div>
        </div>
        
        <div class="input-container">
          <div class="input-wrapper">
            <input id="q" type="text" placeholder="Type your question here..." autocomplete="off" />
          </div>
          <button class="send-button" id="send">Send</button>
        </div>
      </div>
    </div>
    
    <script>
      const msgs = document.getElementById('msgs');
      const sendBtn = document.getElementById('send');
      const input = document.getElementById('q');
      const clearBtn = document.getElementById('clearBtn');
      
      // Auto-scroll function with smooth behavior
      function scrollToBottom(smooth = true) {
        if (smooth) {
          msgs.scrollTo({
            top: msgs.scrollHeight,
            behavior: 'smooth'
          });
        } else {
          msgs.scrollTop = msgs.scrollHeight;
        }
      }
      
      // Check if user is near bottom (within 100px)
      function isNearBottom() {
        return msgs.scrollHeight - msgs.scrollTop - msgs.clientHeight < 100;
      }
      
      function addMessage(role, text, isThinking = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        
        const bubble = document.createElement('div');
        bubble.className = `message-bubble ${isThinking ? 'thinking' : ''}`;
        bubble.innerText = text;
        
        // Add action buttons for bot messages
        if (role === 'bot' && !isThinking) {
          const actions = document.createElement('div');
          actions.className = 'message-actions';
          
          const copyBtn = document.createElement('button');
          copyBtn.className = 'action-btn';
          copyBtn.innerHTML = 'üìã Copy';
          copyBtn.onclick = () => {
            navigator.clipboard.writeText(text).then(() => {
              copyBtn.innerHTML = '‚úì Copied!';
              setTimeout(() => {
                copyBtn.innerHTML = 'üìã Copy';
              }, 2000);
            });
          };
          
          actions.appendChild(copyBtn);
          messageDiv.appendChild(bubble);
          messageDiv.appendChild(actions);
        } else {
          messageDiv.appendChild(bubble);
        }
        
        msgs.appendChild(messageDiv);
        
        // Auto-scroll if near bottom
        if (isNearBottom()) {
          setTimeout(() => scrollToBottom(true), 50);
        }
        
        return bubble;
      }
      
      function addSource(sourceText) {
        const sourceDiv = document.createElement('div');
        sourceDiv.className = 'message-source';
        sourceDiv.innerText = 'Source: ' + sourceText;
        msgs.appendChild(sourceDiv);
        
        // Auto-scroll
        if (isNearBottom()) {
          setTimeout(() => scrollToBottom(true), 50);
        }
      }
      
      function typeText(element, text, speed = 15) {
        element.classList.add('typing');
        let i = 0;
        element.innerText = '';
        
        function type() {
          if (i < text.length) {
            element.innerText += text.charAt(i);
            i++;
            
            // Auto-scroll during typing (every 3 characters for performance)
            if (i % 3 === 0 && isNearBottom()) {
              scrollToBottom(true);
            }
            
            setTimeout(type, speed);
          } else {
            element.classList.remove('typing');
            // Final scroll after typing completes
            setTimeout(() => scrollToBottom(true), 100);
          }
        }
        
        type();
      }
      
      function sendMessage() {
        const q = input.value.trim();
        if (!q || sendBtn.disabled) return;
        
        // Add user message
        addMessage('user', q);
        input.value = '';
        sendBtn.disabled = true;
        
        // Scroll to show user message
        setTimeout(() => scrollToBottom(true), 100);
        
        // Add thinking message
        const thinkingBubble = addMessage('bot', 'Thinking...', true);
        
        // Send request
        fetch('/chat', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify({ q })
        })
        .then(r => r.json())
        .then(j => {
          // Remove thinking class
          thinkingBubble.classList.remove('thinking');
          
          // Type out the response
          const reply = j.reply || 'No answer found.';
          typeText(thinkingBubble, reply, 15);
          
          // Add source after typing
          if (j.source) {
            setTimeout(() => {
              addSource(j.source);
            }, reply.length * 15 + 300);
          }
          
          sendBtn.disabled = false;
          input.focus();
        })
        .catch(e => {
          thinkingBubble.classList.remove('thinking');
          thinkingBubble.innerText = 'Error: ' + e.message;
          sendBtn.disabled = false;
          setTimeout(() => scrollToBottom(true), 100);
        });
      }
      
      // Clear chat function
      clearBtn.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all messages?')) {
          msgs.innerHTML = '<div class="message bot"><div class="message-bubble">Hello! I\'m your AI Knowledge Assistant. I can answer questions based on your knowledge base dataset. How can I help you today?</div></div>';
          setTimeout(() => scrollToBottom(false), 100);
        }
      });
      
      sendBtn.onclick = sendMessage;
      
      input.onkeydown = (e) => {
        if (e.key === 'Enter' && !e.shiftKey && !sendBtn.disabled) {
          e.preventDefault();
          sendMessage();
        }
      };
      
      // Theme Toggle
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const body = document.body;
      
      const savedTheme = localStorage.getItem('theme') || 'light';
      body.setAttribute('data-theme', savedTheme);
      themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      
      themeToggle.addEventListener('click', () => {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', newTheme);
        themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        localStorage.setItem('theme', newTheme);
      });
      
      // Focus input on load
      window.addEventListener('load', () => {
        input.focus();
        setTimeout(() => scrollToBottom(false), 100);
      });
      
      // Auto-scroll on window resize
      window.addEventListener('resize', () => {
        if (isNearBottom()) {
          setTimeout(() => scrollToBottom(false), 100);
        }
      });
    </script>
  </body>
</html>
